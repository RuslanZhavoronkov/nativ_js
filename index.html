<!DOCTYPE html>
<script src="axios.js"></script>
<script src="api.js"></script>
<script src="doAfter.js"></script>
<script>
  // внутрь Promise передаем колбэк-функцию, которая собственно и есть та логика, которую промис обещает выполнить.
  // let myPromise = new Promise((resolve, reject) => {
  //   //этот колбэк тут же вызывается не асинхронно
  //   setTimeout(() => {
  //     //alert("hey");
  //     resolve(Math.random());
  //   }, 2000);

  //   console.log(1);
  //   console.log(2);
  //   console.log(3);
  // });

  // console.log(myPromise);
  // // ниже по коду мы можем подписаться, на промис, чтобы он (промис) вызвал нашу функцию, когда он (промис) зарезолвится. Для этого передаём в метод then колбэк-функцию)
  // myPromise.then((response) => {
  //   console.log(`myPromise зарезолвился, и я узнал об этом ${response}`);
  //   console.log(myPromise);
  // });

  // myPromise.then((response) => {
  //   console.log(
  //     `Я показываюсь второй раз на зарезолвленный промис ${response}`
  //   );
  //   console.log(myPromise);
  // });

  // doAfter(5).then(() => console.log("я сработал через 5 секунд"));
  // doAfter(3).then(() => console.log("а я сработал через 3 секунд"));
  // doAfter(10).then(() => console.log("я сработал через 10 секунд"));

  // let pr1 = doAfter(1);
  // let pr2 = pr1.then((n)=> {
  //   console.log(`pr1 зарезолвился ${n}`)
  //   return n*1000
  // });
  // let pr3 = pr2.then((n) => {
  //   console.log(`pr2 зарезолвился ${n}`)
  //   return n*1000
  // });
  // let pr4 = pr3.then((n) => {
  //   console.log(`pr3 зарезолвился ${n}`)
  // });

  // console.log(pr1, pr2, pr3, pr4);

  // .then(() => console.log("я сработал через 3 секунд"))
  // .catch((error)=> {console.log('some error')})
  // promise3.then(() => console.log("и я тоже следом сработал через 3 секунд"));
  // promise3.then(() => console.log("и я"));

  // api.sendStudentsCountToItKamasutra(20).then((response) => {
  //   console.log(response.data);
  // });

  // let msPromise = api.getVacanciesCountFromMicrosoft()
  // .then((response) => console.log(response.data))

  // let googlePromise = api.getVacanciesCountFromGoogle()
  // .then((response) => console.log(response.data))

  // api.sendStudentsCountToItKamasutra(XXXX)
  // .then((response) => console.log(response.data))

  //my variant
  let msPromise = api.getVacanciesCountFromMicrosoft();

  let googlePromise = api.getVacanciesCountFromGoogle();

  const allPromise = Promise.all([msPromise, googlePromise]); //await resolve two promise
  allPromise
    .then((response) => {
      let responseFromMS = response[0].data.vacancies;
      let responseFromGoogle = response[1].data.vacancies;
      let summVacancies = responseFromMS + responseFromGoogle;

      api
        .sendStudentsCountToItKamasutra(summVacancies)
        .then((response) => console.log(response.data));
    })
    .catch(() => {
      alert("sorry reload youapplication");
    });

  const api = {
    getVacanciesCountFromMicrosoft() {
      axios.get("https://microsoft.com").then((response) => {
        return response.data.vacancies;
      });
    },
    getVacanciesCountFromGoogle() {
      axios.get(`https://google.com`).then((response) => {
        return response.data.vacancies;
      });
    },
  };
</script>
